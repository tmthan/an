(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[904],{70009:(e,t,n)=>{Promise.resolve().then(n.bind(n,7217))},7217:(e,t,n)=>{"use strict";n.r(t),n.d(t,{Random:()=>J,default:()=>z});var a=n(95155),r=n(46742),l=n(26509),s=n(9014),i=n(79005),o=n(12115);let c=[{id:"com",name:"Cơm"},{id:"pho",name:"Phở"}],d="GET_RANDOM_LIST";var u=n(41657),h=n(82133),m=n(22810),x=n(2796),g=n(242),j=n(76237),p=n(9365),b=n(7787),A=n(27656),y=n(42625),f=n(13697),k=n(547),v=n(43302);function w(){return(0,k.I)({queryKey:[d],queryFn:()=>(0,v.oJ)()})}var S=n(35906),C=n(25848),M=n(89670),N=n(99373),L=n(57810),R=n(79254),_=n.n(R),F=n(49113),I=n.n(F);let{Dragger:P}=M.A,{Paragraph:q}=r.A,E=function(e){let{setListTemp:t}=e,n=async e=>{try{let n=new(_()).Workbook,a=await e.arrayBuffer();await n.xlsx.load(a);let r=n.worksheets[0],l=[];r.eachRow((e,t)=>{t>1&&l.push(I().get(e.values,1))}),t(l.concat("").map(e=>({id:(0,f.A)(),name:e}))),N.Ay.success("Đọc file th\xe0nh c\xf4ng!")}catch(e){console.error("Error reading Excel file",e),N.Ay.error("Kh\xf4ng đọc được file Excel")}};return(0,a.jsxs)("div",{className:"pb-4",children:[(0,a.jsxs)(P,{name:"file",multiple:!1,beforeUpload:e=>(n(e),!1),onDrop(e){console.log("Dropped files",e.dataTransfer.files)},accept:".xlsx",children:[(0,a.jsx)("p",{className:"ant-upload-drag-icon",children:(0,a.jsx)(L.A,{})}),(0,a.jsx)(q,{children:"Nhập từ file excel hoặc nhập thủ c\xf4ng từng m\xf3n"})]}),(0,a.jsx)("a",{href:"/mon-an-ngau-nhien.xlsx",target:"_blank",children:"Tải file mẫu"})]})};n(28288);let{Title:T}=r.A;function O(e){let{setFoodList:t}=e,[n,r]=(0,o.useState)(!1),[l,s]=(0,o.useState)("Menu chưa đặt t\xean"),[c,k]=(0,o.useState)([{id:(0,f.A)(),name:""}]),{data:M}=w(),{mutate:N}=function(){let e=(0,S.jE)();return(0,C.n)({mutationFn:v.ln,onSuccess(){e.invalidateQueries({queryKey:[d]})}})}(),{mutate:L}=function(){let e=(0,S.jE)();return(0,C.n)({mutationFn:e=>(0,v.Hd)(e),onSuccess(){e.invalidateQueries({queryKey:[d]})}})}(),R=(0,o.useCallback)((e,t)=>{let n=c.map((n,a)=>t===a?{...n,name:e}:n);t===c.length-1&&n.push({id:(0,f.A)(),name:""}),k(n)},[c]),_=(0,o.useCallback)(e=>{k(c.filter((t,n)=>n!==e))},[c]),F=[{title:"T\xean m\xf3n",dataIndex:"name",key:"name",render:(e,t,n)=>(0,a.jsx)(u.A,{value:e,placeholder:"Tab để sang d\xf2ng kế tiếp",onChange:e=>R(e.target.value,n)})},{title:"Xo\xe1",dataIndex:"delete",key:"delete",width:20,render:(e,t,n)=>n!==c.length-1?(0,a.jsx)(A.A,{onClick:()=>_(n)}):null}];return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.Ay,{size:"small",onClick:()=>r(!0),icon:(0,a.jsx)(y.A,{}),children:"Menu"}),(0,a.jsx)(h.A,{title:"Menu",onClose:()=>r(!1),open:n,width:"80%",style:{background:"rgba(255, 255, 255, 0.8)",backdropFilter:"blur(10px)"},footer:(0,a.jsx)(m.A,{justify:"end",children:(0,a.jsx)(x.A,{children:(0,a.jsx)(i.Ay,{type:"primary",onClick:function(){let e=c.filter(e=>e.name);N({name:l,list:e}),t(e),s("Danh s\xe1ch chưa đặt t\xean"),k([{id:(0,f.A)(),name:""}]),r(!1)},children:"Xong"})})}),children:(0,a.jsxs)(m.A,{gutter:[20,0],children:[(0,a.jsxs)(x.A,{span:24,md:12,children:[(0,a.jsx)(T,{level:3,children:"Nhập Menu"}),(0,a.jsx)(g.A,{columns:F,dataSource:c,pagination:!1,className:"random-table"})]}),(0,a.jsxs)(x.A,{span:24,md:12,children:[(0,a.jsx)(T,{level:3,children:"Lưu Menu"}),(0,a.jsx)(j.A,{children:(0,a.jsx)(j.A.Item,{label:"T\xean Menu",children:(0,a.jsx)(u.A,{allowClear:!0,value:l,onChange:e=>s(e.target.value),style:{background:"rgba(255,255,255,0.3)",border:"none"}})})}),(0,a.jsx)(E,{setListTemp:k}),(0,a.jsx)(p.A,{}),(0,a.jsx)(T,{level:3,children:"Menu đ\xe3 lưu"}),(0,a.jsx)(b.A,{itemLayout:"horizontal",dataSource:null!=M?M:[],renderItem:e=>(0,a.jsx)(b.A.Item,{actions:[(0,a.jsx)("a",{onClick:()=>{L(e.id)},children:(0,a.jsx)(A.A,{})},"delete")],children:(0,a.jsx)(b.A.Item.Meta,{title:(0,a.jsx)("a",{onClick:()=>{t(e.items),r(!1)},children:e.name}),description:e.items.map(e=>e.name).join(", ")})})})]})]})})]})}var B=n(15812);let{Title:D,Paragraph:K}=r.A;function J(){let{data:e,isFetched:t}=w(),[n,r]=(0,o.useState)([]),[d,u]=(0,o.useState)(),h=(0,o.useCallback)(()=>(null==n?void 0:n.length)?n[Math.floor(Math.random()*n.length)]:t&&(null==e?void 0:e.length)?e[0].items[Math.floor(Math.random()*e[0].items.length)]:c[Math.floor(Math.random()*c.length)],[n,t,e]),m=(0,o.useCallback)(()=>{let e=h();u(e);let t=0,n=setInterval(()=>{e=h(),t++,u(e),69===t&&clearInterval(n)},10)},[h]);return(0,o.useEffect)(()=>{t&&e&&m()},[m,t,e]),(0,a.jsx)(l.A,{justify:"center",align:"center",style:{height:"100vh",background:"url('/ban-tiec.jpeg')",backgroundSize:"cover",backgroundRepeat:"no-repeat",backgroundPosition:"center"},children:(0,a.jsx)(s.A,{title:"H\xf4m nay ăn g\xec?",style:{width:400,background:"rgba(255, 255, 255, 0.8)",backdropFilter:"blur(10px)"},extra:(0,a.jsx)(O,{setFoodList:r}),children:(0,a.jsxs)(l.A,{gap:"middle",align:"center",vertical:!0,children:[(0,a.jsx)(K,{className:"text-center px-14",children:(0,a.jsx)(D,{className:"text-center",style:{background:"-webkit-linear-gradient(#7F00FF, #E100FF)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:null==d?void 0:d.name})}),(0,a.jsx)(i.Ay,{onClick:m,type:"primary",icon:(0,a.jsx)(B.A,{}),children:"Chọn lại"})]})})})}let z=J},43302:(e,t,n)=>{"use strict";n.d(t,{Hd:()=>g,Kb:()=>h,Sj:()=>d,ln:()=>x,oJ:()=>m});var a=n(14449),r=n(21455),l=n.n(r),s=n(13697),i=n(49113),o=n.n(i),c=n(56818);let d=a.Oh.addCollection(c.q.RandomList);class u extends a.Ay{getRandomList(){return super.getAll(this.store)}async syncRandomList(){let e=d.find({});for(let t of(await super.deleteAll(this.store),e)){let e=o().omit(t,["$loki","meta"]);await super.save(this.store,e)}return e}constructor(...e){super(...e),this.store=c.q.RandomList}}let h=new u;function m(){return d.find({}).sort((e,t)=>l()(t.created_at).isAfter(l()(e.created_at))?1:-1)}async function x(e){let{name:t,list:n}=e,a=await Promise.resolve(d.insert({id:(0,s.A)(),name:t,items:n,created_at:l()().toDate()}));return await h.syncRandomList(),a}async function g(e){let t=await Promise.resolve(d.findAndRemove({id:e}));return await h.syncRandomList(),t}},56818:(e,t,n)=>{"use strict";n.d(t,{q:()=>a});var a=function(e){return e.RandomList="random_list",e.ShareBill="share_bill",e}({})},14449:(e,t,n)=>{"use strict";n.d(t,{Ay:()=>o,Oh:()=>s});var a=n(51288),r=n.n(a),l=n(56818);let s=new(r())("anuong.db");class i{async init(){return this.database?this.database:new Promise((e,t)=>{let n=window.indexedDB.open("anuong",1);n.onupgradeneeded=()=>{let e=n.result;e.objectStoreNames.contains(l.q.RandomList)||e.createObjectStore(l.q.RandomList,{keyPath:"id",autoIncrement:!0}),e.objectStoreNames.contains(l.q.ShareBill)||e.createObjectStore(l.q.ShareBill,{keyPath:"id",autoIncrement:!0})},n.onsuccess=()=>{this.database=n.result,e(this.database)},n.onerror=()=>{t(n.error)}})}async save(e,t){let n=await this.init();return new Promise((a,r)=>{let l=n.transaction(e,"readwrite").objectStore(e),s=JSON.parse(JSON.stringify(t)),i=l.add(s);i.onsuccess=()=>a(),i.onerror=()=>r(i.error)})}async getAll(e){let t=await this.init();return new Promise((n,a)=>{let r=t.transaction(e,"readonly").objectStore(e).getAll();r.onsuccess=()=>n(r.result),r.onerror=()=>a(r.error)})}async deleteAll(e){let t=await this.init();return new Promise((n,a)=>{let r=t.transaction(e,"readwrite").objectStore(e).clear();r.onsuccess=()=>n(e),r.onerror=()=>a(r.error)})}constructor(){this.database=null}}let o=i},28288:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[457,935,600,343,103,838,256,455,724,441,517,358],()=>t(70009)),_N_E=e.O()}]);