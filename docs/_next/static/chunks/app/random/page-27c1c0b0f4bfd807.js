(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[904],{70009:(e,t,n)=>{Promise.resolve().then(n.bind(n,7217))},7217:(e,t,n)=>{"use strict";n.r(t),n.d(t,{Random:()=>G,default:()=>H});var a=n(95155),r=n(29288),s=n(26509),l=n(9014),i=n(79005),o=n(12115);let c=[{id:"com",name:"Cơm"},{id:"pho",name:"Phở"}],d="GET_RANDOM_LIST";var u=n(41657),h=n(82133),m=n(22810),x=n(2796),j=n(242),p=n(76237),A=n(9365),f=n(7787),g=n(27656),y=n(42625),v=n(13697),b=n(547),w=n(43302);function k(){return(0,b.I)({queryKey:[d],queryFn:()=>(0,w.oJ)()})}var S=n(35906),C=n(25848),N=n(89670),M=n(99373),L=n(57810),_=n(79254),R=n.n(_),I=n(49113),q=n.n(I);let{Dragger:E}=N.A,{Paragraph:P}=r.A,O=function(e){let{setListTemp:t}=e,n=async e=>{try{let n=new(R()).Workbook,a=await e.arrayBuffer();await n.xlsx.load(a);let r=n.worksheets[0],s=[];r.eachRow((e,t)=>{t>1&&s.push(q().get(e.values,1))}),t(s.concat("").map(e=>({id:(0,v.A)(),name:e}))),M.Ay.success("Đọc file th\xe0nh c\xf4ng!")}catch(e){console.error("Error reading Excel file",e),M.Ay.error("Kh\xf4ng đọc được file Excel")}};return(0,a.jsxs)("div",{className:"pb-4",children:[(0,a.jsxs)(E,{name:"file",multiple:!1,beforeUpload:e=>(n(e),!1),onDrop(e){console.log("Dropped files",e.dataTransfer.files)},accept:".xlsx",children:[(0,a.jsx)("p",{className:"ant-upload-drag-icon",children:(0,a.jsx)(L.A,{})}),(0,a.jsx)(P,{children:"Nhập từ file excel hoặc nhập thủ c\xf4ng từng m\xf3n"})]}),(0,a.jsx)("a",{href:"/mon-an-ngau-nhien.xlsx",target:"_blank",children:"Tải file mẫu"})]})};n(28288);var T=n(65872);let{Title:D}=r.A;function B(e){let{setFoodList:t}=e,[n,r]=(0,o.useState)(!1),[s,l]=(0,o.useState)("Menu chưa đặt t\xean"),[c,b]=(0,o.useState)([{id:(0,v.A)(),name:""}]),{data:N}=k(),{mutate:M}=function(){let e=(0,S.jE)();return(0,C.n)({mutationFn:w.ln,onSuccess(){e.invalidateQueries({queryKey:[d]})}})}(),{mutate:L}=function(){let e=(0,S.jE)();return(0,C.n)({mutationFn:e=>(0,w.Hd)(e),onSuccess(){e.invalidateQueries({queryKey:[d]})}})}(),_=(0,T.G)(),R=(0,o.useCallback)((e,t)=>{let n=c.map((n,a)=>t===a?{...n,name:e}:n);t===c.length-1&&n.push({id:(0,v.A)(),name:""}),b(n)},[c]),I=(0,o.useCallback)(e=>{b(c.filter((t,n)=>n!==e))},[c]),q=[{title:"T\xean m\xf3n",dataIndex:"name",key:"name",render:(e,t,n)=>(0,a.jsx)(u.A,{value:e,placeholder:"Tab để sang d\xf2ng kế tiếp",onChange:e=>R(e.target.value,n)})},{title:"Xo\xe1",dataIndex:"delete",key:"delete",width:20,render:(e,t,n)=>n!==c.length-1?(0,a.jsx)(g.A,{onClick:()=>I(n)}):null}];return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.Ay,{size:"small",onClick:()=>r(!0),icon:(0,a.jsx)(y.A,{}),children:"Menu"}),(0,a.jsx)(h.A,{title:"Menu",onClose:()=>r(!1),open:n,width:_?"80%":"100%",className:"random-drawer",footer:(0,a.jsx)(m.A,{justify:"end",children:(0,a.jsx)(x.A,{children:(0,a.jsx)(i.Ay,{type:"primary",onClick:function(){let e=c.filter(e=>e.name);M({name:s,list:e}),t(e),l("Danh s\xe1ch chưa đặt t\xean"),b([{id:(0,v.A)(),name:""}]),r(!1)},children:"Xong"})})}),children:(0,a.jsxs)(m.A,{gutter:[20,0],children:[(0,a.jsxs)(x.A,{span:24,md:12,children:[(0,a.jsx)(D,{level:3,children:"Nhập Menu"}),(0,a.jsx)(j.A,{columns:q,dataSource:c,pagination:!1,className:"random-table"})]}),(0,a.jsxs)(x.A,{span:24,md:12,children:[(0,a.jsx)(D,{level:3,children:"Lưu Menu"}),(0,a.jsx)(p.A,{children:(0,a.jsx)(p.A.Item,{label:"T\xean Menu",children:(0,a.jsx)(u.A,{allowClear:!0,value:s,onChange:e=>l(e.target.value),style:{background:"rgba(255,255,255,0.3)",border:"none"}})})}),(0,a.jsx)(O,{setListTemp:b}),(0,a.jsx)(A.A,{}),(0,a.jsx)(D,{level:3,children:"Menu đ\xe3 lưu"}),(0,a.jsx)(f.A,{itemLayout:"horizontal",dataSource:null!=N?N:[],renderItem:e=>(0,a.jsx)(f.A.Item,{actions:[(0,a.jsx)("a",{onClick:()=>{L(e.id)},children:(0,a.jsx)(g.A,{})},"delete")],children:(0,a.jsx)(f.A.Item.Meta,{title:(0,a.jsx)("a",{onClick:()=>{t(e.items),r(!1)},children:e.name}),description:e.items.map(e=>e.name).join(", ")})})})]})]})})]})}var F=n(15812);let{Title:K,Paragraph:J}=r.A;function G(){let{data:e,isFetched:t}=k(),[n,r]=(0,o.useState)([]),[d,u]=(0,o.useState)(),h=(0,o.useCallback)(()=>(null==n?void 0:n.length)?n[Math.floor(Math.random()*n.length)]:t&&(null==e?void 0:e.length)?e[0].items[Math.floor(Math.random()*e[0].items.length)]:c[Math.floor(Math.random()*c.length)],[n,t,e]),m=(0,o.useCallback)(()=>{let e=h();u(e);let t=0,n=setInterval(()=>{e=h(),t++,u(e),69===t&&clearInterval(n)},10)},[h]);return(0,o.useEffect)(()=>{t&&e&&m()},[m,t,e]),(0,a.jsx)(s.A,{justify:"center",align:"center",className:"app-container",style:{background:"url('/ban-tiec.jpeg')"},children:(0,a.jsx)(l.A,{title:"H\xf4m nay ăn g\xec?",className:"app-card random-card",extra:(0,a.jsx)(B,{setFoodList:r}),children:(0,a.jsxs)(s.A,{gap:"middle",align:"center",vertical:!0,children:[(0,a.jsx)(J,{className:"text-center px-14",children:(0,a.jsx)(K,{className:"food-name",children:null==d?void 0:d.name})}),(0,a.jsx)(i.Ay,{onClick:m,type:"primary",icon:(0,a.jsx)(F.A,{}),children:"Chọn lại"})]})})})}let H=G},43302:(e,t,n)=>{"use strict";n.d(t,{Hd:()=>j,Kb:()=>h,Sj:()=>d,ln:()=>x,oJ:()=>m});var a=n(14449),r=n(21455),s=n.n(r),l=n(13697),i=n(49113),o=n.n(i),c=n(56818);let d=a.Oh.addCollection(c.q.RandomList);class u extends a.Ay{getRandomList(){return super.getAll(this.store)}async syncRandomList(){let e=d.find({});for(let t of(await super.deleteAll(this.store),e)){let e=o().omit(t,["$loki","meta"]);await super.save(this.store,e)}return e}constructor(...e){super(...e),this.store=c.q.RandomList}}let h=new u;function m(){return d.find({}).sort((e,t)=>s()(t.created_at).isAfter(s()(e.created_at))?1:-1)}async function x(e){let{name:t,list:n}=e,a=await Promise.resolve(d.insert({id:(0,l.A)(),name:t,items:n,created_at:s()().toDate()}));return await h.syncRandomList(),a}async function j(e){let t=await Promise.resolve(d.findAndRemove({id:e}));return await h.syncRandomList(),t}},56818:(e,t,n)=>{"use strict";n.d(t,{q:()=>a});var a=function(e){return e.RandomList="random_list",e.ShareBill="share_bill",e}({})},14449:(e,t,n)=>{"use strict";n.d(t,{Ay:()=>o,Oh:()=>l});var a=n(51288),r=n.n(a),s=n(56818);let l=new(r())("anuong.db");class i{async init(){return this.database?this.database:new Promise((e,t)=>{let n=window.indexedDB.open("anuong",1);n.onupgradeneeded=()=>{let e=n.result;e.objectStoreNames.contains(s.q.RandomList)||e.createObjectStore(s.q.RandomList,{keyPath:"id",autoIncrement:!0}),e.objectStoreNames.contains(s.q.ShareBill)||e.createObjectStore(s.q.ShareBill,{keyPath:"id",autoIncrement:!0})},n.onsuccess=()=>{this.database=n.result,e(this.database)},n.onerror=()=>{t(n.error)}})}async save(e,t){let n=await this.init();return new Promise((a,r)=>{let s=n.transaction(e,"readwrite").objectStore(e),l=JSON.parse(JSON.stringify(t)),i=s.add(l);i.onsuccess=()=>a(),i.onerror=()=>r(i.error)})}async getAll(e){let t=await this.init();return new Promise((n,a)=>{let r=t.transaction(e,"readonly").objectStore(e).getAll();r.onsuccess=()=>n(r.result),r.onerror=()=>a(r.error)})}async deleteAll(e){let t=await this.init();return new Promise((n,a)=>{let r=t.transaction(e,"readwrite").objectStore(e).clear();r.onsuccess=()=>n(e),r.onerror=()=>a(r.error)})}constructor(){this.database=null}}let o=i},65872:(e,t,n)=>{"use strict";n.d(t,{G:()=>s});var a=n(12115),r=n(12942);let s=()=>{var e;let[t,n]=a.useState(null),s=(0,r.A)(t),l=(null!==(e=null==s?void 0:s.width)&&void 0!==e?e:0)>=768;return(0,a.useEffect)(()=>{var e,t;n(null===(t=window)||void 0===t?void 0:null===(e=t.document)||void 0===e?void 0:e.body)},[]),l}},28288:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[457,935,600,343,103,838,256,529,914,441,517,358],()=>t(70009)),_N_E=e.O()}]);