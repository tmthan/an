(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[328],{79516:(e,t,n)=>{Promise.resolve().then(n.bind(n,93587))},93587:(e,t,n)=>{"use strict";n.r(t),n.d(t,{ShareBill:()=>Q,default:()=>U});var r=n(95155),i=n(12115),a=n(26509),l=n(9014),s=n(79005),o=n(82957),d=n(93779),c=n(9365),u=n(99373),h=function(e){return e.ShareByMember="ShareByMember",e.ShareByFood="ShareByFood",e}({}),m=n(5050),p=n(18198),y=n(22810),g=n(2796),v=n(76237),x=n(89351),j=n(242),b=n(35153),A=n(96030),f=n(99425);n(6536);var S=n(65872),k=n(42707);let C=e=>{let{foodList:t,memberList:n,billItems:a,setBillItems:l,shippingFee:o,setShippingFee:d,discountAmount:c,setDiscountAmount:u,calculatorMode:C,setCalculatorMode:w}=e,B=(0,S.G)(),q=[{title:"T\xean m\xf3n",dataIndex:"foodName",key:"foodName"}].concat(n.filter(e=>e.name).map(e=>({title:e.name,dataIndex:e.id,key:e.id,render:(t,n)=>(0,r.jsxs)(m.A,{children:[t>0&&(0,r.jsx)(s.Ay,{shape:"circle",onClick:()=>{var t,r;return t=n.foodId,r=e.id,void l(a.map(e=>e.food===t&&e.member===r?{...e,quantity:Math.max(e.quantity-1,0)}:e))},icon:(0,r.jsx)(b.A,{}),size:"small"}),t>0&&(0,r.jsx)(p.A,{value:t,onChange:t=>{var r,i,s;return r=null!=t?t:0,i=n.foodId,s=e.id,void l(a.map(e=>e.food===i&&e.member===s?{...e,quantity:r}:e))},style:{width:50},formatter:e=>"".concat(e).replace(/\B(?=(\d{3})+(?!\d))/g,",")}),(0,r.jsx)(s.Ay,{shape:"circle",icon:(0,r.jsx)(A.A,{}),size:"small",onClick:()=>{var t,r;return t=n.foodId,r=e.id,void l(a.map(e=>e.food===t&&e.member===r?{...e,quantity:e.quantity+1}:e))}})]})}))),M=i.useMemo(()=>{let e=[];for(let r of t.filter(e=>e.name)){let t={key:r.id,foodName:r.name,foodId:r.id,quantity:0};for(let e of n.filter(e=>e.name)){let n=a.find(t=>t.food===r.id&&t.member===e.id);t[e.id]=n?n.quantity:0}e.push(t)}return e},[t,n,a]);return(0,r.jsxs)(y.A,{children:[(0,r.jsx)(g.A,{span:24,children:(0,r.jsxs)(v.A,{labelCol:{span:8},wrapperCol:{span:16},autoComplete:"off",children:[(0,r.jsxs)(y.A,{gutter:[20,20],children:[(0,r.jsx)(g.A,{span:24,md:12,children:(0,r.jsx)(f.A,{label:"Ph\xed vận chuyện + phụ ph\xed",children:(0,r.jsx)(p.A,{value:o,onChange:e=>d(null!=e?e:0),suffix:"đ",formatter:e=>"".concat(e).replace(/\B(?=(\d{3})+(?!\d))/g,","),step:1e3,style:{width:"100%"}})})}),(0,r.jsx)(g.A,{span:24,md:12,children:(0,r.jsx)(f.A,{label:"Giảm gi\xe1",children:(0,r.jsx)(p.A,{value:c,onChange:e=>u(null!=e?e:0),suffix:"đ",step:1e3,formatter:e=>"".concat(e).replace(/\B(?=(\d{3})+(?!\d))/g,","),style:{width:"100%"}})})})]}),(0,r.jsx)(y.A,{gutter:[20,20],children:(0,r.jsx)(g.A,{span:24,md:12,children:(0,r.jsx)(v.A.Item,{name:"radio-button",label:"C\xe1ch chia",children:(0,r.jsxs)(x.Ay.Group,{onChange:e=>w(e.target.value),value:C,children:[(0,r.jsx)(x.Ay,{value:h.ShareByMember,children:"Chia theo đầu người"}),(0,r.jsx)(x.Ay,{value:h.ShareByFood,children:"Chia theo m\xf3n"})]})})})})]})}),!B&&(0,r.jsx)(k.A,{children:"Giao diện d\xe0nh ri\xeang cho điện thoại sẽ sớm được cập nhật"}),(0,r.jsx)(g.A,{span:24,children:(0,r.jsx)(j.A,{scroll:{y:275,x:"max-content"},columns:q,dataSource:M,pagination:!1,className:"share-bill-table"})})]})};var w=n(7787),B=n(49113),q=n.n(B);let M=e=>{let{foodList:t,billItems:n,memberList:a,calculatorMode:l,discountAmount:s,shippingFee:o}=e,d=q().keyBy(a,"id"),c=i.useCallback(e=>{let r=q().keyBy(t,"id");return n.filter(t=>t.member===e&&t.quantity>0).map(e=>{var t;return null===(t=r[e.food])||void 0===t?void 0:t.name}).join(", ")},[n,t]),u=[{title:"T\xean th\xe0nh vi\xean",dataIndex:"member",key:"member",render:e=>{var t,n;return(0,r.jsx)(w.A.Item.Meta,{title:null!==(n=null===(t=d[e])||void 0===t?void 0:t.name)&&void 0!==n?n:"",description:c(e)})}},{title:"Tiền",dataIndex:"money",key:"money",render:e=>new Intl.NumberFormat("en-US").format(e)}],m=i.useMemo(()=>{let e=n.filter(e=>e.quantity>0&&e.member&&e.food),r=q().groupBy(e,"member"),i=q().keyBy(t,"id"),a=Object.keys(r).length,c=q().sumBy(e,"quantity"),u=q().round((o-s)/a),m=q().round((o-s)/c);return l===h.ShareByMember?Object.entries(r).map(e=>{let[t,n]=e,r=i[n[0].food],a=q().sumBy(n,e=>{var t;return(null!==(t=null==r?void 0:r.price)&&void 0!==t?t:0)*e.quantity});return{key:t,member:t,money:q().round(a+u)}}):Object.entries(r).map(e=>{var t,n;let[r,a]=e,l=i[a[0].food],s=q().sumBy(a,e=>{var t;return(null!==(t=null==l?void 0:l.price)&&void 0!==t?t:0)*e.quantity});return{key:r,member:null!==(n=null===(t=d[r])||void 0===t?void 0:t.name)&&void 0!==n?n:"",money:q().round(s+m)}})},[n,l,s,t,d,o]);return(0,r.jsx)(j.A,{columns:u,dataSource:m,pagination:!1})};var I=n(13697),T=n(35906),L=n(25848),N=n(29214);let F="SHARE_BILL";var _=n(21455),G=n.n(_),P=n(29288),O=n(41657),D=n(97295);let{Title:Y,Paragraph:H}=P.A,R=function(e){let{foodList:t,setFoodList:n,memberList:a,setMemberList:l}=e,s=Math.max(t.length,a.length),o=(0,S.G)(),[d,u]=i.useState(!1),h=i.useCallback((e,t)=>{let n=a.map((n,r)=>t===r?{...n,name:e}:n);t===a.length-1&&n.push({id:(0,I.A)(),name:""}),l(n)},[a,l]),m=i.useCallback((e,r)=>{let i=t.map((t,n)=>r===n?{...t,name:e}:t);r===t.length-1&&i.push({id:(0,I.A)(),name:"",price:null}),n(i)},[t,n]),v=i.useCallback((e,r)=>{let i=t.map((t,n)=>r===n?{...t,price:null!=e?e:0}:t);r===t.length-1&&i.push({id:(0,I.A)(),name:"",price:null!=e?e:null}),n(i)},[t,n]),x=i.useMemo(()=>{let e=[];for(let f=0;f<s;f++){var n,i,l,d,u,x,j,b,A;e.push((0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(y.A,{gutter:[10,10],style:{marginBottom:8},children:[(0,r.jsx)(g.A,{span:24,md:10,children:a[f]&&(0,r.jsx)(O.A,{value:null!==(u=null===(n=a[f])||void 0===n?void 0:n.name)&&void 0!==u?u:null,placeholder:o?"Tab để sang \xf4 kế tiếp":"T\xean th\xe0nh vi\xean",onChange:e=>h(e.target.value,f)})}),t[f]?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(g.A,{span:24,md:10,children:(0,r.jsx)(O.A,{value:null!==(x=null===(i=t[f])||void 0===i?void 0:i.name)&&void 0!==x?x:null,placeholder:o?"Tab để sang \xf4 kế tiếp":"T\xean m\xf3n",onChange:e=>m(e.target.value,f)})}),(0,r.jsx)(g.A,{span:24,md:4,children:(0,r.jsx)(p.A,{style:{width:"100%"},value:null!==(j=null===(l=t[f])||void 0===l?void 0:l.price)&&void 0!==j?j:null,formatter:e=>"".concat(e).replace(/\B(?=(\d{3})+(?!\d))/g,","),placeholder:o?"Tab để sang \xf4 kế tiếp":"Gi\xe1 tiền",onChange:e=>v(e,f),suffix:"đ",step:1e3})})]}):null]},null!==(A=null!==(b=null===(d=a[f])||void 0===d?void 0:d.id)&&void 0!==b?b:t[f].id)&&void 0!==A?A:f),f<s-1&&!o&&(0,r.jsx)(c.A,{})]}))}return e},[t,o,s,a,m,h,v]);return(0,r.jsxs)(r.Fragment,{children:[o&&(0,r.jsxs)(y.A,{gutter:[10,10],children:[(0,r.jsx)(g.A,{span:24,md:10,children:(0,r.jsx)(Y,{level:5,children:"T\xean th\xe0nh vi\xean"})}),(0,r.jsx)(g.A,{span:24,md:10,children:(0,r.jsx)(Y,{level:5,children:"T\xean m\xf3n"})}),(0,r.jsx)(g.A,{span:24,md:4,children:(0,r.jsx)(Y,{level:5,children:"Gi\xe1 tiền"})})]}),x,(0,r.jsx)(y.A,{children:(0,r.jsx)(g.A,{span:24,children:(0,r.jsx)("a",{onClick:()=>u(!0),children:"C\xf3 nhiều người đặt m\xf3n giống nhau?"})})}),(0,r.jsxs)(D.A,{footer:null,open:d,onCancel:()=>u(!1),children:[(0,r.jsx)(Y,{level:4,children:"C\xf3 nhiều hơn một người c\xf9ng đặt m\xf3n giống nhau?"}),(0,r.jsx)(H,{children:"Đừng lo. Bạn chỉ cần nhập t\xean những người ấy v\xe0o \xf4 t\xean th\xe0nh vi\xean ở cuối danh s\xe1ch v\xe0 bỏ trống c\xe1c cột t\xean m\xf3n v\xe0 gi\xe1. Giao diện ở bước tiếp theo sẽ cho bạn lựa chọn những người n\xe0o đặt m\xf3n ấy."}),(0,r.jsx)(Y,{level:4,children:"C\xf3 một người đặt nhiều m\xf3n?"}),(0,r.jsx)(H,{children:"Cũng tương tự như tr\xean. Bạn chỉ việc nhập t\xean v\xe0 gi\xe1 của m\xf3n đ\xf3 ở cột t\xean v\xe0 m\xf3n v\xe0o cuối danh s\xe1ch. Giao diện ở bước tiếp theo sẽ gi\xfap bạn lựa chọn người n\xe0o đặt những m\xf3n n\xe0o."})]})]})},E=function(e){let{setStartTransaction:t}=e,{token:n}=o.A.useToken(),[m,p]=i.useState(0),[y,g]=i.useState([{id:(0,I.A)(),name:"",price:null}]),[v,x]=i.useState([{id:(0,I.A)(),name:""}]),[j,b]=i.useState([]),[A,f]=i.useState(0),[k,w]=i.useState(0),[B,q]=i.useState(h.ShareByMember),{mutate:_}=function(){let e=(0,T.jE)();return(0,L.n)({mutationFn:N.wN,onSuccess(){e.invalidateQueries({queryKey:[F]})}})}(),P=(0,S.G)(),O=[{title:"Nhập dữ liệu",content:(0,r.jsx)(R,{foodList:y,setFoodList:g,memberList:v,setMemberList:x})},{title:"Chia tiền",content:(0,r.jsx)(C,{foodList:y,memberList:v,billItems:j,setBillItems:b,shippingFee:A,setShippingFee:f,discountAmount:k,setDiscountAmount:w,calculatorMode:B,setCalculatorMode:q})},{title:"Kết quả",content:(0,r.jsx)(M,{foodList:y,billItems:j,calculatorMode:B,shippingFee:A,discountAmount:k,memberList:v})}],D=()=>{let e=[];for(let[t,n]of y.filter(e=>e.name).entries())for(let[r,i]of v.filter(e=>e.name).entries())e.push({id:(0,I.A)(),food:n.id,member:i.id,quantity:t===r?1:0});b(e)},Y=()=>{m===O.length-3&&D(),p(m+1)},H=()=>{p(m-1)},E=()=>{_({foodList:y,memberList:v,billItems:j,shippingFee:A,discountAmount:k,calculatorMode:B,created_at:new Date,id:(0,I.A)(),name:"Chia tiền ng\xe0y ".concat(G()().format("DD/MM/YYYY HH:mm:ss"))}),g([{id:(0,I.A)(),name:"",price:null}]),x([{id:(0,I.A)(),name:""}]),b([]),f(0),p(0),w(0),q(h.ShareByMember),t(!1)},z=O.map(e=>({key:e.title,title:e.title})),K={color:n.colorTextTertiary,borderRadius:n.borderRadiusLG};return(0,r.jsx)(a.A,{justify:"center",align:"center",style:{height:"100vh",background:"url('/ban-tiec.jpeg')",backgroundSize:"cover",backgroundRepeat:"no-repeat",backgroundPosition:"center",padding:20,overflow:"auto"},children:(0,r.jsxs)(l.A,{style:{width:"100%",background:"rgba(255, 255, 255, 0.8)",backdropFilter:"blur(10px)"},styles:{body:{overflow:"auto",height:"calc(100vh - 100px)"}},children:[(0,r.jsx)(d.A,{current:m,items:z}),!P&&(0,r.jsx)(c.A,{}),(0,r.jsx)("div",{style:K,className:"transaction-wrapper",children:O[m].content}),(0,r.jsx)(c.A,{}),(0,r.jsxs)("div",{children:[m<O.length-1&&(0,r.jsx)(s.Ay,{type:"primary",onClick:()=>Y(),children:"Tiếp"}),m===O.length-1&&(0,r.jsx)(s.Ay,{type:"primary",onClick:()=>{u.Ay.success("Processing complete!"),E()},children:"Xong"}),m>0&&(0,r.jsx)(s.Ay,{style:{margin:"0 8px"},onClick:()=>H(),children:"Trước"})]})]})})};var z=n(547);let{Title:K}=P.A,J=function(){let{data:e}=(0,z.I)({queryKey:[F],queryFn:()=>(0,N.HM)()}),[t,n]=i.useState(null),[a,l]=i.useState(!1),s=[{title:"T\xean",dataIndex:"name",key:"name",render:(e,t)=>(0,r.jsx)("a",{onClick:()=>{n(t),l(!0)},children:e})}];return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(K,{level:3,children:"Lịch sử"}),(0,r.jsx)(j.A,{columns:s,dataSource:e,pagination:!1,className:"share-bill-table"}),(0,r.jsx)(D.A,{footer:!1,open:a,onCancel:()=>l(!1),children:t&&(0,r.jsx)(M,{billItems:t.billItems,calculatorMode:t.calculatorMode,shippingFee:t.shippingFee,discountAmount:t.discountAmount,foodList:t.foodList,memberList:t.memberList})})]})},Q=()=>{let[e,t]=i.useState(!1);return e?(0,r.jsx)(E,{setStartTransaction:t}):(0,r.jsx)(a.A,{justify:"center",align:"center",className:"app-container",style:{background:"url('/chia-tien.jpeg')"},children:(0,r.jsxs)(l.A,{title:"Chia tiền ho\xe1 đơn",className:"app-card share-bill-card",children:[(0,r.jsx)(a.A,{justify:"center",align:"center",children:(0,r.jsx)(s.Ay,{size:"large",type:"primary",onClick:()=>{t(!0)},children:"Bắt đầu"})}),(0,r.jsx)(J,{})]})})},U=Q},29214:(e,t,n)=>{"use strict";n.d(t,{Bu:()=>d,HM:()=>h,l_:()=>u,wN:()=>m});var r=n(21455),i=n.n(r),a=n(56818),l=n(14449),s=n(49113),o=n.n(s);let d=l.Oh.addCollection(a.q.ShareBill);class c extends l.Ay{getShareBill(){return super.getAll(this.store)}async syncShareBill(){let e=d.find({});for(let t of(await super.deleteAll(this.store),e)){let e=o().omit(t,["$loki","meta"]);await super.save(this.store,e)}return e}constructor(...e){super(...e),this.store=a.q.ShareBill}}let u=new c;function h(){return d.find({}).sort((e,t)=>new Date(t.created_at).getTime()>new Date(e.created_at).getTime()?1:-1)}async function m(e){let t=await Promise.resolve(d.insert({...e,name:"Chia tiền ng\xe0y ".concat(i()().format("DD/MM/YYYY HH:mm:ss")),created_at:i()().toDate()}));return await u.syncShareBill(),t}},56818:(e,t,n)=>{"use strict";n.d(t,{q:()=>r});var r=function(e){return e.RandomList="random_list",e.ShareBill="share_bill",e}({})},14449:(e,t,n)=>{"use strict";n.d(t,{Ay:()=>o,Oh:()=>l});var r=n(51288),i=n.n(r),a=n(56818);let l=new(i())("anuong.db");class s{async init(){return this.database?this.database:new Promise((e,t)=>{let n=window.indexedDB.open("anuong",1);n.onupgradeneeded=()=>{let e=n.result;e.objectStoreNames.contains(a.q.RandomList)||e.createObjectStore(a.q.RandomList,{keyPath:"id",autoIncrement:!0}),e.objectStoreNames.contains(a.q.ShareBill)||e.createObjectStore(a.q.ShareBill,{keyPath:"id",autoIncrement:!0})},n.onsuccess=()=>{this.database=n.result,e(this.database)},n.onerror=()=>{t(n.error)}})}async save(e,t){let n=await this.init();return new Promise((r,i)=>{let a=n.transaction(e,"readwrite").objectStore(e),l=JSON.parse(JSON.stringify(t)),s=a.add(l);s.onsuccess=()=>r(),s.onerror=()=>i(s.error)})}async getAll(e){let t=await this.init();return new Promise((n,r)=>{let i=t.transaction(e,"readonly").objectStore(e).getAll();i.onsuccess=()=>n(i.result),i.onerror=()=>r(i.error)})}async deleteAll(e){let t=await this.init();return new Promise((n,r)=>{let i=t.transaction(e,"readwrite").objectStore(e).clear();i.onsuccess=()=>n(e),i.onerror=()=>r(i.error)})}constructor(){this.database=null}}let o=s},65872:(e,t,n)=>{"use strict";n.d(t,{G:()=>a});var r=n(12115),i=n(12942);let a=()=>{var e;let[t,n]=r.useState(null),a=(0,i.A)(t),l=(null!==(e=null==a?void 0:a.width)&&void 0!==e?e:0)>=768;return(0,r.useEffect)(()=>{var e,t;n(null===(t=window)||void 0===t?void 0:null===(e=t.document)||void 0===e?void 0:e.body)},[]),l}},6536:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[65,935,600,103,838,256,529,54,441,517,358],()=>t(79516)),_N_E=e.O()}]);