(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[328],{79516:(e,t,n)=>{Promise.resolve().then(n.bind(n,29194))},29194:(e,t,n)=>{"use strict";n.r(t),n.d(t,{ShareBill:()=>J,default:()=>Q});var r=n(95155),a=n(12115),l=n(26509),i=n(9014),s=n(79005),o=n(82957),d=n(93779),c=n(99373),u=n(46742),h=n(41657),m=n(18198),p=n(22810),y=n(2796),x=n(242),b=n(13697),g=n(27656);n(6536);let{Title:j}=u.A,A=e=>{let{foodList:t,setFoodList:n}=e,l=a.useCallback((e,r)=>{let a=t.map((t,n)=>r===n?{...t,name:e}:t);r===t.length-1&&a.push({id:(0,b.A)(),name:"",price:0}),n(a)},[t,n]),i=a.useCallback((e,r)=>{let a=t.map((t,n)=>r===n?{...t,price:null!=e?e:0}:t);r===t.length-1&&a.push({id:(0,b.A)(),name:"",price:null!=e?e:0}),n(a)},[t,n]),s=a.useCallback(e=>{n(t.filter((t,n)=>n!==e))},[t,n]),o=[{title:"T\xean m\xf3n",dataIndex:"name",key:"name",render:(e,t,n)=>(0,r.jsx)(h.A,{value:e,placeholder:"Tab để sang \xf4 kế tiếp",onChange:e=>l(e.target.value,n)})},{title:"Gi\xe1",dataIndex:"price",key:"price",render:(e,t,n)=>(0,r.jsx)(m.A,{style:{width:"100%"},value:e,formatter:e=>"".concat(e).replace(/\B(?=(\d{3})+(?!\d))/g,","),placeholder:"Tab để sang \xf4 kế tiếp",onChange:e=>i(e,n),suffix:"đ",step:1e3})},{title:"Xo\xe1",dataIndex:"delete",key:"delete",width:20,render:(e,n,a)=>a!==t.length-1?(0,r.jsx)(g.A,{onClick:()=>s(a)}):null}];return(0,r.jsxs)(p.A,{children:[(0,r.jsx)(y.A,{span:24,children:(0,r.jsx)(j,{level:3,children:"Nhập danh s\xe1ch m\xf3n"})}),(0,r.jsx)(y.A,{span:24,children:(0,r.jsx)(x.A,{columns:o,dataSource:t,pagination:!1,className:"share-bill-table"})})]})},{Title:f}=u.A,v=e=>{let{memberList:t,setMemberList:n}=e,l=a.useCallback((e,r)=>{let a=t.map((t,n)=>r===n?{...t,name:e}:t);r===t.length-1&&a.push({id:(0,b.A)(),name:""}),n(a)},[t,n]),i=a.useCallback(e=>{n(t.filter((t,n)=>n!==e))},[t,n]),s=[{title:"T\xean th\xe0nh vi\xean",dataIndex:"name",key:"name",render:(e,t,n)=>(0,r.jsx)(h.A,{value:e,placeholder:"Tab để sang \xf4 kế tiếp",onChange:e=>l(e.target.value,n)})},{title:"Xo\xe1",dataIndex:"delete",key:"delete",width:20,render:(e,n,a)=>a!==t.length-1?(0,r.jsx)(g.A,{onClick:()=>i(a)}):null}];return(0,r.jsxs)(p.A,{children:[(0,r.jsx)(y.A,{span:24,children:(0,r.jsx)(f,{level:3,children:"Nhập danh s\xe1ch th\xe0nh vi\xean"})}),(0,r.jsx)(y.A,{span:24,children:(0,r.jsx)(x.A,{className:"share-bill-table",columns:s,dataSource:t,pagination:!1})})]})};var k=function(e){return e.ShareByMember="ShareByMember",e.ShareByFood="ShareByFood",e}({}),S=n(5050),C=n(76237),w=n(89351),B=n(35153),I=n(96030),q=n(99425);let{Title:T}=u.A,M=e=>{let{foodList:t,memberList:n,billItems:l,setBillItems:i,shippingFee:o,setShippingFee:d,discountAmount:c,setDiscountAmount:u,calculatorMode:h,setCalculatorMode:b}=e,g=[{title:"T\xean m\xf3n",dataIndex:"foodName",key:"foodName"}].concat(n.filter(e=>e.name).map(e=>({title:e.name,dataIndex:e.id,key:e.id,render:(t,n)=>(0,r.jsxs)(S.A,{children:[(0,r.jsx)(s.Ay,{shape:"circle",onClick:()=>{var t,r;return t=n.foodId,r=e.id,void i(l.map(e=>e.food===t&&e.member===r?{...e,quantity:Math.max(e.quantity-1,0)}:e))},icon:(0,r.jsx)(B.A,{}),size:"small"}),(0,r.jsx)(m.A,{value:t,onChange:t=>{var r,a,s;return r=null!=t?t:0,a=n.foodId,s=e.id,void i(l.map(e=>e.food===a&&e.member===s?{...e,quantity:r}:e))},style:{width:50},formatter:e=>"".concat(e).replace(/\B(?=(\d{3})+(?!\d))/g,",")}),(0,r.jsx)(s.Ay,{shape:"circle",icon:(0,r.jsx)(I.A,{}),size:"small",onClick:()=>{var t,r;return t=n.foodId,r=e.id,void i(l.map(e=>e.food===t&&e.member===r?{...e,quantity:e.quantity+1}:e))}})]})}))),j=a.useMemo(()=>{let e=[];for(let r of t.filter(e=>e.name)){let t={key:r.id,foodName:r.name,foodId:r.id,quantity:0};for(let e of n.filter(e=>e.name)){let n=l.find(t=>t.food===r.id&&t.member===e.id);t[e.id]=n?n.quantity:0}e.push(t)}return e},[t,n,l]);return(0,r.jsxs)(p.A,{children:[(0,r.jsx)(y.A,{span:24,children:(0,r.jsx)(T,{level:3,children:"Chia tiền"})}),(0,r.jsx)(y.A,{span:24,children:(0,r.jsxs)(C.A,{labelCol:{span:8},wrapperCol:{span:16},autoComplete:"off",children:[(0,r.jsxs)(p.A,{gutter:[20,20],children:[(0,r.jsx)(y.A,{span:12,children:(0,r.jsx)(q.A,{label:"Ph\xed vận chuyện + phụ ph\xed",children:(0,r.jsx)(m.A,{value:o,onChange:e=>d(null!=e?e:0),suffix:"đ",formatter:e=>"".concat(e).replace(/\B(?=(\d{3})+(?!\d))/g,","),step:1e3,style:{width:"100%"}})})}),(0,r.jsx)(y.A,{span:12,children:(0,r.jsx)(q.A,{label:"Giảm gi\xe1",children:(0,r.jsx)(m.A,{value:c,onChange:e=>u(null!=e?e:0),suffix:"đ",step:1e3,formatter:e=>"".concat(e).replace(/\B(?=(\d{3})+(?!\d))/g,","),style:{width:"100%"}})})})]}),(0,r.jsxs)(p.A,{gutter:[20,20],children:[(0,r.jsx)(y.A,{span:12,children:(0,r.jsx)(C.A.Item,{name:"radio-button",label:"C\xe1ch chia",children:(0,r.jsxs)(w.Ay.Group,{onChange:e=>b(e.target.value),value:h,children:[(0,r.jsx)(w.Ay,{value:k.ShareByMember,children:"Chia theo đầu người"}),(0,r.jsx)(w.Ay,{value:k.ShareByFood,children:"Chia theo m\xf3n"})]})})}),(0,r.jsx)(y.A,{span:12})]})]})}),(0,r.jsx)(y.A,{span:24,children:(0,r.jsx)(x.A,{scroll:{y:275,x:"max-content"},columns:g,dataSource:j,pagination:!1,className:"share-bill-table"})})]})};var N=n(49113),L=n.n(N);let{Title:F}=u.A,_=e=>{let{foodList:t,billItems:n,memberList:l,calculatorMode:i,discountAmount:s,shippingFee:o}=e,d=[{title:"T\xean th\xe0nh vi\xean",dataIndex:"member",key:"member"},{title:"Tiền",dataIndex:"money",key:"money",render:e=>new Intl.NumberFormat("en-US").format(e)}],c=a.useMemo(()=>{let e=n.filter(e=>e.quantity>0),r=L().groupBy(e,"member"),a=L().keyBy(t,"id"),d=Object.keys(r).length,c=L().sumBy(e,"quantity"),u=L().keyBy(l,"id"),h=L().round((o-s)/d),m=L().round((o-s)/c);return i===k.ShareByMember?Object.entries(r).map(e=>{var t,n;let[r,l]=e,i=a[l[0].food],s=L().sumBy(l,e=>{var t;return(null!==(t=null==i?void 0:i.price)&&void 0!==t?t:0)*e.quantity});return{key:r,member:null!==(n=null===(t=u[r])||void 0===t?void 0:t.name)&&void 0!==n?n:"",money:L().round(s+h)}}):Object.entries(r).map(e=>{var t,n;let[r,l]=e,i=a[l[0].food],s=L().sumBy(l,e=>{var t;return(null!==(t=null==i?void 0:i.price)&&void 0!==t?t:0)*e.quantity});return{key:r,member:null!==(n=null===(t=u[r])||void 0===t?void 0:t.name)&&void 0!==n?n:"",money:L().round(s+m)}})},[n,i,s,t,l,o]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(F,{level:3,children:"Kết Quả"}),(0,r.jsx)(x.A,{columns:d,dataSource:c,pagination:!1})]})};var P=n(35906),O=n(25848),D=n(29214);let H="SHARE_BILL";var R=n(21455),Y=n.n(R);let z=function(e){let{setStartTransaction:t}=e,{token:n}=o.A.useToken(),[u,h]=a.useState(0),[m,p]=a.useState([{id:(0,b.A)(),name:"",price:0}]),[y,x]=a.useState([{id:(0,b.A)(),name:""}]),[g,j]=a.useState([]),[f,S]=a.useState(0),[C,w]=a.useState(0),[B,I]=a.useState(k.ShareByMember),{mutate:q}=function(){let e=(0,P.jE)();return(0,O.n)({mutationFn:D.wN,onSuccess(){e.invalidateQueries({queryKey:[H]})}})}(),T=[{title:"Nhập danh s\xe1ch m\xf3n",content:(0,r.jsx)(A,{foodList:m,setFoodList:p})},{title:"Nhập danh s\xe1ch th\xe0nh vi\xean",content:(0,r.jsx)(v,{memberList:y,setMemberList:x})},{title:"Chia tiền",content:(0,r.jsx)(M,{foodList:m,memberList:y,billItems:g,setBillItems:j,shippingFee:f,setShippingFee:S,discountAmount:C,setDiscountAmount:w,calculatorMode:B,setCalculatorMode:I})},{title:"Kết quả",content:(0,r.jsx)(_,{foodList:m,billItems:g,calculatorMode:B,shippingFee:f,discountAmount:C,memberList:y})}],N=()=>{let e=[];for(let t of m)for(let n of y)e.push({id:(0,b.A)(),food:t.id,member:n.id,quantity:0});j(e)},L=()=>{u===T.length-3&&N(),h(u+1)},F=()=>{h(u-1)},R=()=>{q({foodList:m,memberList:y,billItems:g,shippingFee:f,discountAmount:C,calculatorMode:B,created_at:new Date,id:(0,b.A)(),name:"Chia tiền ng\xe0y ".concat(Y()().format("DD/MM/YYYY HH:mm:ss"))}),p([{id:(0,b.A)(),name:"",price:0}]),x([{id:(0,b.A)(),name:""}]),j([]),S(0),h(0),w(0),I(k.ShareByMember),t(!1)},z=T.map(e=>({key:e.title,title:e.title})),E={lineHeight:"260px",textAlign:"center",color:n.colorTextTertiary,backgroundColor:n.colorFillAlter,borderRadius:n.borderRadiusLG,border:"1px dashed ".concat(n.colorBorder),marginTop:16};return(0,r.jsx)(l.A,{justify:"center",align:"center",style:{height:"100vh",background:"url('/ban-tiec.jpeg')",backgroundSize:"cover",backgroundRepeat:"no-repeat",backgroundPosition:"center",padding:20,overflow:"auto"},children:(0,r.jsxs)(i.A,{style:{width:"100%",background:"rgba(255, 255, 255, 0.8)",backdropFilter:"blur(10px)"},styles:{body:{overflow:"auto",height:"calc(100vh - 100px)"}},children:[(0,r.jsx)(d.A,{current:u,items:z}),(0,r.jsx)("div",{style:E,children:T[u].content}),(0,r.jsxs)("div",{style:{marginTop:24},children:[u<T.length-1&&(0,r.jsx)(s.Ay,{type:"primary",onClick:()=>L(),children:"Tiếp"}),u===T.length-1&&(0,r.jsx)(s.Ay,{type:"primary",onClick:()=>{c.Ay.success("Processing complete!"),R()},children:"Xong"}),u>0&&(0,r.jsx)(s.Ay,{style:{margin:"0 8px"},onClick:()=>F(),children:"Trước"})]})]})})};var E=n(97295),G=n(547);let{Title:K}=u.A,X=function(){let{data:e}=(0,G.I)({queryKey:[H],queryFn:()=>(0,D.HM)()}),[t,n]=a.useState(null),[l,i]=a.useState(!1),s=[{title:"T\xean",dataIndex:"name",key:"name",render:(e,t)=>(0,r.jsx)("a",{onClick:()=>{n(t),i(!0)},children:e})}];return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(K,{level:3,children:"Lịch sử"}),(0,r.jsx)(x.A,{columns:s,dataSource:e,pagination:!1,className:"share-bill-table"}),(0,r.jsx)(E.A,{footer:!1,open:l,onCancel:()=>i(!1),children:t&&(0,r.jsx)(_,{billItems:t.billItems,calculatorMode:t.calculatorMode,shippingFee:t.shippingFee,discountAmount:t.discountAmount,foodList:t.foodList,memberList:t.memberList})})]})},J=()=>{let[e,t]=a.useState(!1);return e?(0,r.jsx)(z,{setStartTransaction:t}):(0,r.jsx)(l.A,{justify:"center",align:"center",style:{height:"100vh",background:"url('/chia-tien.jpeg')",backgroundSize:"cover",backgroundRepeat:"no-repeat",backgroundPosition:"center"},children:(0,r.jsxs)(i.A,{title:"Chia tiền ho\xe1 đơn",style:{width:800,background:"rgba(255, 255, 255, 0.8)",backdropFilter:"blur(10px)"},children:[(0,r.jsx)(l.A,{justify:"center",align:"center",children:(0,r.jsx)(s.Ay,{size:"large",type:"primary",onClick:()=>{t(!0)},children:"Bắt đầu"})}),(0,r.jsx)(X,{})]})})},Q=J},29214:(e,t,n)=>{"use strict";n.d(t,{Bu:()=>d,HM:()=>h,l_:()=>u,wN:()=>m});var r=n(21455),a=n.n(r),l=n(56818),i=n(14449),s=n(49113),o=n.n(s);let d=i.Oh.addCollection(l.q.ShareBill);class c extends i.Ay{getShareBill(){return super.getAll(this.store)}async syncShareBill(){let e=d.find({});for(let t of(await super.deleteAll(this.store),e)){let e=o().omit(t,["$loki","meta"]);await super.save(this.store,e)}return e}constructor(...e){super(...e),this.store=l.q.ShareBill}}let u=new c;function h(){return d.find({}).sort((e,t)=>new Date(t.created_at).getTime()>new Date(e.created_at).getTime()?1:-1)}async function m(e){let t=await Promise.resolve(d.insert({...e,name:"Chia tiền ng\xe0y ".concat(a()().format("DD/MM/YYYY HH:mm:ss")),created_at:a()().toDate()}));return await u.syncShareBill(),t}},56818:(e,t,n)=>{"use strict";n.d(t,{q:()=>r});var r=function(e){return e.RandomList="random_list",e.ShareBill="share_bill",e}({})},14449:(e,t,n)=>{"use strict";n.d(t,{Ay:()=>o,Oh:()=>i});var r=n(51288),a=n.n(r),l=n(56818);let i=new(a())("anuong.db");class s{async init(){return this.database?this.database:new Promise((e,t)=>{let n=window.indexedDB.open("anuong",1);n.onupgradeneeded=()=>{let e=n.result;e.objectStoreNames.contains(l.q.RandomList)||e.createObjectStore(l.q.RandomList,{keyPath:"id",autoIncrement:!0}),e.objectStoreNames.contains(l.q.ShareBill)||e.createObjectStore(l.q.ShareBill,{keyPath:"id",autoIncrement:!0})},n.onsuccess=()=>{this.database=n.result,e(this.database)},n.onerror=()=>{t(n.error)}})}async save(e,t){let n=await this.init();return new Promise((r,a)=>{let l=n.transaction(e,"readwrite").objectStore(e),i=JSON.parse(JSON.stringify(t)),s=l.add(i);s.onsuccess=()=>r(),s.onerror=()=>a(s.error)})}async getAll(e){let t=await this.init();return new Promise((n,r)=>{let a=t.transaction(e,"readonly").objectStore(e).getAll();a.onsuccess=()=>n(a.result),a.onerror=()=>r(a.error)})}async deleteAll(e){let t=await this.init();return new Promise((n,r)=>{let a=t.transaction(e,"readwrite").objectStore(e).clear();a.onsuccess=()=>n(e),a.onerror=()=>r(a.error)})}constructor(){this.database=null}}let o=s},6536:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[65,935,600,103,838,256,455,54,441,517,358],()=>t(79516)),_N_E=e.O()}]);