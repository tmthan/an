(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[328],{79516:(e,t,n)=>{Promise.resolve().then(n.bind(n,29194))},29194:(e,t,n)=>{"use strict";n.r(t),n.d(t,{ShareBill:()=>X,default:()=>z});var r=n(95155),a=n(12115),i=n(79005),l=n(82957),s=n(93779),o=n(99373),d=n(46742),c=n(41657),u=n(18198),m=n(22810),h=n(2796),p=n(17342),y=n(13697),x=n(27656);let{Title:j}=d.A,A=e=>{let{foodList:t,setFoodList:n}=e,i=a.useCallback((e,r)=>{let a=t.map((t,n)=>r===n?{...t,name:e}:t);r===t.length-1&&a.push({id:(0,y.A)(),name:"",price:0}),n(a)},[t,n]),l=a.useCallback((e,r)=>{let a=t.map((t,n)=>r===n?{...t,price:null!=e?e:0}:t);r===t.length-1&&a.push({id:(0,y.A)(),name:"",price:null!=e?e:0}),n(a)},[t,n]),s=a.useCallback(e=>{n(t.filter((t,n)=>n!==e))},[t,n]),o=[{title:"T\xean m\xf3n",dataIndex:"name",key:"name",render:(e,t,n)=>(0,r.jsx)(c.A,{value:e,placeholder:"Tab để sang \xf4 kế tiếp",onChange:e=>i(e.target.value,n)})},{title:"Gi\xe1",dataIndex:"price",key:"price",render:(e,t,n)=>(0,r.jsx)(u.A,{value:e,formatter:e=>"".concat(e).replace(/\B(?=(\d{3})+(?!\d))/g,","),placeholder:"Tab để sang \xf4 kế tiếp",onChange:e=>l(e,n),suffix:"đ",step:1e3})},{title:"Xo\xe1",dataIndex:"delete",key:"delete",width:20,render:(e,n,a)=>a!==t.length-1?(0,r.jsx)(x.A,{onClick:()=>s(a)}):null}];return(0,r.jsxs)(m.A,{children:[(0,r.jsx)(h.A,{span:24,children:(0,r.jsx)(j,{level:3,children:"Nhập danh s\xe1ch m\xf3n"})}),(0,r.jsx)(h.A,{span:24,children:(0,r.jsx)(p.A,{columns:o,dataSource:t,pagination:!1})})]})},{Title:f}=d.A,b=e=>{let{memberList:t,setMemberList:n}=e,i=a.useCallback((e,r)=>{let a=t.map((t,n)=>r===n?{...t,name:e}:t);r===t.length-1&&a.push({id:(0,y.A)(),name:""}),n(a)},[t,n]),l=a.useCallback(e=>{n(t.filter((t,n)=>n!==e))},[t,n]),s=[{title:"T\xean th\xe0nh vi\xean",dataIndex:"name",key:"name",render:(e,t,n)=>(0,r.jsx)(c.A,{value:e,placeholder:"Tab để sang \xf4 kế tiếp",onChange:e=>i(e.target.value,n)})},{title:"Xo\xe1",dataIndex:"delete",key:"delete",width:20,render:(e,n,a)=>a!==t.length-1?(0,r.jsx)(x.A,{onClick:()=>l(a)}):null}];return(0,r.jsxs)(m.A,{children:[(0,r.jsx)(h.A,{span:24,children:(0,r.jsx)(f,{level:3,children:"Nhập danh s\xe1ch th\xe0nh vi\xean"})}),(0,r.jsx)(h.A,{span:24,children:(0,r.jsx)(p.A,{columns:s,dataSource:t,pagination:!1})})]})};var g=function(e){return e.ShareByMember="ShareByMember",e.ShareByFood="ShareByFood",e}({}),v=n(5050),S=n(76237),k=n(89351),C=n(35153),B=n(96030),w=n(99425);let{Title:I}=d.A,q=e=>{let{foodList:t,memberList:n,billItems:l,setBillItems:s,shippingFee:o,setShippingFee:d,discountAmount:c,setDiscountAmount:y,calculatorMode:x,setCalculatorMode:j}=e,A=[{title:"T\xean m\xf3n",dataIndex:"foodName",key:"foodName"}].concat(n.filter(e=>e.name).map(e=>({title:e.name,dataIndex:e.id,key:e.id,render:(t,n)=>(0,r.jsxs)(v.A,{children:[(0,r.jsx)(i.Ay,{shape:"circle",onClick:()=>{var t,r;return t=n.foodId,r=e.id,void s(l.map(e=>e.food===t&&e.member===r?{...e,quantity:Math.max(e.quantity-1,0)}:e))},icon:(0,r.jsx)(C.A,{}),size:"small"}),(0,r.jsx)(u.A,{value:t,onChange:t=>{var r,a,i;return r=null!=t?t:0,a=n.foodId,i=e.id,void s(l.map(e=>e.food===a&&e.member===i?{...e,quantity:r}:e))},style:{width:50},formatter:e=>"".concat(e).replace(/\B(?=(\d{3})+(?!\d))/g,",")}),(0,r.jsx)(i.Ay,{shape:"circle",icon:(0,r.jsx)(B.A,{}),size:"small",onClick:()=>{var t,r;return t=n.foodId,r=e.id,void s(l.map(e=>e.food===t&&e.member===r?{...e,quantity:e.quantity+1}:e))}})]})}))),f=a.useMemo(()=>{let e=[];for(let r of t.filter(e=>e.name)){let t={key:r.id,foodName:r.name,foodId:r.id,quantity:0};for(let e of n.filter(e=>e.name)){let n=l.find(t=>t.food===r.id&&t.member===e.id);t[e.id]=n?n.quantity:0}e.push(t)}return e},[t,n,l]);return(0,r.jsxs)(m.A,{children:[(0,r.jsx)(h.A,{span:24,children:(0,r.jsx)(I,{level:3,children:"Chia tiền"})}),(0,r.jsx)(h.A,{span:24,children:(0,r.jsxs)(S.A,{labelCol:{span:8},wrapperCol:{span:16},autoComplete:"off",children:[(0,r.jsxs)(m.A,{children:[(0,r.jsx)(h.A,{span:12,children:(0,r.jsx)(w.A,{label:"Ph\xed vận chuyện + phụ ph\xed",children:(0,r.jsx)(u.A,{value:o,onChange:e=>d(null!=e?e:0),suffix:"đ",formatter:e=>"".concat(e).replace(/\B(?=(\d{3})+(?!\d))/g,",")})})}),(0,r.jsx)(h.A,{span:12,children:(0,r.jsx)(w.A,{label:"Giảm gi\xe1",children:(0,r.jsx)(u.A,{value:c,onChange:e=>y(null!=e?e:0),suffix:"đ",step:1e3,formatter:e=>"".concat(e).replace(/\B(?=(\d{3})+(?!\d))/g,",")})})})]}),(0,r.jsxs)(m.A,{children:[(0,r.jsx)(h.A,{span:12,children:(0,r.jsx)(S.A.Item,{name:"radio-button",label:"Radio.Button",children:(0,r.jsxs)(k.Ay.Group,{onChange:e=>j(e.target.value),value:x,children:[(0,r.jsx)(k.Ay,{value:g.ShareByMember,children:"Chia theo đầu người"}),(0,r.jsx)(k.Ay,{value:g.ShareByFood,children:"Chia theo m\xf3n"})]})})}),(0,r.jsx)(h.A,{span:12})]})]})}),(0,r.jsx)(h.A,{span:24,children:(0,r.jsx)(p.A,{scroll:{y:275,x:"max-content"},columns:A,dataSource:f,pagination:!1})})]})};var T=n(49113),M=n.n(T);let{Title:L}=d.A,N=e=>{let{foodList:t,billItems:n,memberList:i,calculatorMode:l,discountAmount:s,shippingFee:o}=e,d=[{title:"T\xean th\xe0nh vi\xean",dataIndex:"member",key:"member"},{title:"Tiền",dataIndex:"money",key:"money",render:e=>new Intl.NumberFormat("en-US").format(e)}],c=a.useMemo(()=>{let e=n.filter(e=>e.quantity>0),r=M().groupBy(e,"member"),a=M().keyBy(t,"id"),d=Object.keys(r).length,c=M().sumBy(e,"quantity"),u=M().keyBy(i,"id"),m=M().round((o-s)/d),h=M().round((o-s)/c);return l===g.ShareByMember?Object.entries(r).map(e=>{var t,n;let[r,i]=e,l=a[i[0].food],s=M().sumBy(i,e=>{var t;return(null!==(t=null==l?void 0:l.price)&&void 0!==t?t:0)*e.quantity});return{key:r,member:null!==(n=null===(t=u[r])||void 0===t?void 0:t.name)&&void 0!==n?n:"",money:M().round(s+m)}}):Object.entries(r).map(e=>{var t,n;let[r,i]=e,l=a[i[0].food],s=M().sumBy(i,e=>{var t;return(null!==(t=null==l?void 0:l.price)&&void 0!==t?t:0)*e.quantity});return{key:r,member:null!==(n=null===(t=u[r])||void 0===t?void 0:t.name)&&void 0!==n?n:"",money:M().round(s+h)}})},[n,l,s,t,i,o]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(L,{level:3,children:"Kết Quả"}),(0,r.jsx)(p.A,{columns:d,dataSource:c,pagination:!1})]})};var F=n(35906),_=n(25848),O=n(29214);let D="SHARE_BILL";var P=n(21455),H=n.n(P);let Y=function(e){let{setStartTransaction:t}=e,{token:n}=l.A.useToken(),[d,c]=a.useState(0),[u,m]=a.useState([{id:(0,y.A)(),name:"",price:0}]),[h,p]=a.useState([{id:(0,y.A)(),name:""}]),[x,j]=a.useState([]),[f,v]=a.useState(0),[S,k]=a.useState(0),[C,B]=a.useState(g.ShareByMember),{mutate:w}=function(){let e=(0,F.jE)();return(0,_.n)({mutationFn:O.wN,onSuccess(){e.invalidateQueries({queryKey:[D]})}})}(),I=[{title:"Nhập danh s\xe1ch m\xf3n",content:(0,r.jsx)(A,{foodList:u,setFoodList:m})},{title:"Nhập danh s\xe1ch th\xe0nh vi\xean",content:(0,r.jsx)(b,{memberList:h,setMemberList:p})},{title:"Chia tiền",content:(0,r.jsx)(q,{foodList:u,memberList:h,billItems:x,setBillItems:j,shippingFee:f,setShippingFee:v,discountAmount:S,setDiscountAmount:k,calculatorMode:C,setCalculatorMode:B})},{title:"Kết quả",content:(0,r.jsx)(N,{foodList:u,billItems:x,calculatorMode:C,shippingFee:f,discountAmount:S,memberList:h})}],T=()=>{let e=[];for(let t of u)for(let n of h)e.push({id:(0,y.A)(),food:t.id,member:n.id,quantity:0});j(e)},M=()=>{d===I.length-3&&T(),c(d+1)},L=()=>{c(d-1)},P=()=>{w({foodList:u,memberList:h,billItems:x,shippingFee:f,discountAmount:S,calculatorMode:C,created_at:new Date,id:(0,y.A)(),name:"Chia tiền ng\xe0y ".concat(H()().format("DD/MM/YYYY HH:mm:ss"))}),m([{id:(0,y.A)(),name:"",price:0}]),p([{id:(0,y.A)(),name:""}]),j([]),v(0),c(0),k(0),B(g.ShareByMember),t(!1)},Y=I.map(e=>({key:e.title,title:e.title})),R={lineHeight:"260px",textAlign:"center",color:n.colorTextTertiary,backgroundColor:n.colorFillAlter,borderRadius:n.borderRadiusLG,border:"1px dashed ".concat(n.colorBorder),marginTop:16};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.A,{current:d,items:Y}),(0,r.jsx)("div",{style:R,children:I[d].content}),(0,r.jsxs)("div",{style:{marginTop:24},children:[d<I.length-1&&(0,r.jsx)(i.Ay,{type:"primary",onClick:()=>M(),children:"Tiếp"}),d===I.length-1&&(0,r.jsx)(i.Ay,{type:"primary",onClick:()=>{o.Ay.success("Processing complete!"),P()},children:"Xong"}),d>0&&(0,r.jsx)(i.Ay,{style:{margin:"0 8px"},onClick:()=>L(),children:"Trước"})]})]})};var R=n(97295),E=n(547);let{Title:G}=d.A,K=function(){let{data:e}=(0,E.I)({queryKey:[D],queryFn:()=>(0,O.HM)()}),[t,n]=a.useState(null),[i,l]=a.useState(!1),s=[{title:"T\xean",dataIndex:"name",key:"name",render:(e,t)=>(0,r.jsx)("a",{onClick:()=>{n(t),l(!0)},children:e})}];return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(G,{level:3,children:"Lịch sử"}),(0,r.jsx)(p.A,{columns:s,dataSource:e,pagination:!1}),(0,r.jsx)(R.A,{footer:!1,open:i,onCancel:()=>l(!1),children:t&&(0,r.jsx)(N,{billItems:t.billItems,calculatorMode:t.calculatorMode,shippingFee:t.shippingFee,discountAmount:t.discountAmount,foodList:t.foodList,memberList:t.memberList})})]})},X=()=>{let[e,t]=a.useState(!1);return e?(0,r.jsx)(Y,{setStartTransaction:t}):(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{children:"Chia tiền"}),(0,r.jsx)(i.Ay,{type:"primary",onClick:()=>{t(!0)},children:"Bắt đầu"}),(0,r.jsx)(K,{})]})},z=X},29214:(e,t,n)=>{"use strict";n.d(t,{Bu:()=>d,HM:()=>m,l_:()=>u,wN:()=>h});var r=n(21455),a=n.n(r),i=n(56818),l=n(14449),s=n(49113),o=n.n(s);let d=l.Oh.addCollection(i.q.ShareBill);class c extends l.Ay{getShareBill(){return super.getAll(this.store)}async syncShareBill(){let e=d.find({});for(let t of(await super.deleteAll(this.store),e)){let e=o().omit(t,["$loki","meta"]);await super.save(this.store,e)}return e}constructor(...e){super(...e),this.store=i.q.ShareBill}}let u=new c;function m(){return d.find({}).sort((e,t)=>new Date(t.created_at).getTime()>new Date(e.created_at).getTime()?1:-1)}async function h(e){let t=await Promise.resolve(d.insert({...e,name:"Chia tiền ng\xe0y ".concat(a()().format("DD/MM/YYYY HH:mm:ss")),created_at:a()().toDate()}));return await u.syncShareBill(),t}},56818:(e,t,n)=>{"use strict";n.d(t,{q:()=>r});var r=function(e){return e.RandomList="random_list",e.ShareBill="share_bill",e}({})},14449:(e,t,n)=>{"use strict";n.d(t,{Ay:()=>o,Oh:()=>l});var r=n(51288),a=n.n(r),i=n(56818);let l=new(a())("anuong.db");class s{async init(){return this.database?this.database:new Promise((e,t)=>{let n=window.indexedDB.open("anuong",1);n.onupgradeneeded=()=>{let e=n.result;e.objectStoreNames.contains(i.q.RandomList)||e.createObjectStore(i.q.RandomList,{keyPath:"id",autoIncrement:!0}),e.objectStoreNames.contains(i.q.ShareBill)||e.createObjectStore(i.q.ShareBill,{keyPath:"id",autoIncrement:!0})},n.onsuccess=()=>{this.database=n.result,e(this.database)},n.onerror=()=>{t(n.error)}})}async save(e,t){let n=await this.init();return new Promise((r,a)=>{let i=n.transaction(e,"readwrite").objectStore(e),l=JSON.parse(JSON.stringify(t)),s=i.add(l);s.onsuccess=()=>r(),s.onerror=()=>a(s.error)})}async getAll(e){let t=await this.init();return new Promise((n,r)=>{let a=t.transaction(e,"readonly").objectStore(e).getAll();a.onsuccess=()=>n(a.result),a.onerror=()=>r(a.error)})}async deleteAll(e){let t=await this.init();return new Promise((n,r)=>{let a=t.transaction(e,"readwrite").objectStore(e).clear();a.onsuccess=()=>n(e),a.onerror=()=>r(a.error)})}constructor(){this.database=null}}let o=s}},e=>{var t=t=>e(e.s=t);e.O(0,[935,600,754,999,913,42,171,441,517,358],()=>t(79516)),_N_E=e.O()}]);