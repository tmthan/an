(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[328],{79516:(e,t,n)=>{Promise.resolve().then(n.bind(n,93587))},93587:(e,t,n)=>{"use strict";n.r(t),n.d(t,{ShareBill:()=>$,default:()=>V});var r=n(95155),i=n(12115),l=n(26509),a=n(9014),o=n(79005),s=n(82957),d=n(93779),c=n(9365),u=n(99373),h=function(e){return e.ShareByMember="ShareByMember",e.ShareByFood="ShareByFood",e}({}),m=n(5050),p=n(18198),g=n(22810),x=n(2796),y=n(76237),v=n(89351),j=n(242),b=n(35153),A=n(96030),f=n(99425);n(6536);var S=n(65872),k=n(42707);let w=e=>{let{foodList:t,memberList:n,billItems:l,setBillItems:a,shippingFee:s,setShippingFee:d,discountAmount:c,setDiscountAmount:u,calculatorMode:w,setCalculatorMode:C}=e,B=(0,S.G)(),q=[{title:"T\xean m\xf3n",dataIndex:"foodName",key:"foodName"}].concat(n.filter(e=>e.name).map(e=>({title:e.name,dataIndex:e.id,key:e.id,render:(t,n)=>(0,r.jsxs)(m.A,{children:[t>0&&(0,r.jsx)(o.Ay,{shape:"circle",onClick:()=>{var t,r;return t=n.foodId,r=e.id,void a(l.map(e=>e.food===t&&e.member===r?{...e,quantity:Math.max(e.quantity-1,0)}:e))},icon:(0,r.jsx)(b.A,{}),size:"small"}),t>0&&(0,r.jsx)(p.A,{value:t,onChange:t=>{var r,i,o;return r=null!=t?t:0,i=n.foodId,o=e.id,void a(l.map(e=>e.food===i&&e.member===o?{...e,quantity:r}:e))},style:{width:50},formatter:e=>"".concat(e).replace(/\B(?=(\d{3})+(?!\d))/g,",")}),(0,r.jsx)(o.Ay,{shape:"circle",icon:(0,r.jsx)(A.A,{}),size:"small",onClick:()=>{var t,r;return t=n.foodId,r=e.id,void a(l.map(e=>e.food===t&&e.member===r?{...e,quantity:e.quantity+1}:e))}})]})}))),F=i.useMemo(()=>{let e=[];for(let r of t.filter(e=>e.name)){let t={key:r.id,foodName:r.name,foodId:r.id,quantity:0};for(let e of n.filter(e=>e.name)){let n=l.find(t=>t.food===r.id&&t.member===e.id);t[e.id]=n?n.quantity:0}e.push(t)}return e},[t,n,l]);return(0,r.jsxs)(g.A,{children:[(0,r.jsx)(x.A,{span:24,children:(0,r.jsxs)(y.A,{labelCol:{span:8},wrapperCol:{span:16},autoComplete:"off",children:[(0,r.jsxs)(g.A,{gutter:[20,20],children:[(0,r.jsx)(x.A,{span:24,md:12,children:(0,r.jsx)(f.A,{label:"Ph\xed vận chuyện + phụ ph\xed",children:(0,r.jsx)(p.A,{value:s,onChange:e=>d(null!=e?e:0),suffix:"đ",formatter:e=>"".concat(e).replace(/\B(?=(\d{3})+(?!\d))/g,","),step:1e3,style:{width:"100%"}})})}),(0,r.jsx)(x.A,{span:24,md:12,children:(0,r.jsx)(f.A,{label:"Giảm gi\xe1",children:(0,r.jsx)(p.A,{value:c,onChange:e=>u(null!=e?e:0),suffix:"đ",step:1e3,formatter:e=>"".concat(e).replace(/\B(?=(\d{3})+(?!\d))/g,","),style:{width:"100%"}})})})]}),(0,r.jsx)(g.A,{gutter:[20,20],children:(0,r.jsx)(x.A,{span:24,md:12,children:(0,r.jsx)(y.A.Item,{name:"radio-button",label:"C\xe1ch chia",children:(0,r.jsxs)(v.Ay.Group,{onChange:e=>C(e.target.value),value:w,children:[(0,r.jsx)(v.Ay,{value:h.ShareByMember,children:"Chia theo đầu người"}),(0,r.jsx)(v.Ay,{value:h.ShareByFood,children:"Chia theo m\xf3n"})]})})})})]})}),!B&&(0,r.jsx)(k.A,{children:"Giao diện d\xe0nh ri\xeang cho điện thoại sẽ sớm được cập nhật"}),(0,r.jsx)(x.A,{span:24,children:(0,r.jsx)(j.A,{scroll:{y:275,x:"max-content"},columns:q,dataSource:F,pagination:!1,className:"share-bill-table"})})]})};var C=n(97838),B=n(45100),q=n(7787),F=n(49113),I=n.n(F),M=n(78723);let N=e=>{let{foodList:t,billItems:n,memberList:l,calculatorMode:a,discountAmount:o,shippingFee:s}=e,d=I().keyBy(l,"id"),c=i.useCallback(e=>{let i=I().keyBy(t,"id");return(0,r.jsx)(m.A,{size:"large",children:n.filter(t=>t.member===e&&t.quantity>0).map(e=>{var t,n,l;return(0,r.jsx)(C.A,{count:(0,M.z)(null!==(l=i[e.food].price)&&void 0!==l?l:0),color:"pink",children:(0,r.jsx)(B.A,{bordered:!1,color:"blue",children:e.quantity>1?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(C.A,{count:e.quantity,color:"green"}),null===(t=i[e.food])||void 0===t?void 0:t.name]}):null===(n=i[e.food])||void 0===n?void 0:n.name})},e.id)})})},[n,t]),u=[{title:"T\xean th\xe0nh vi\xean",dataIndex:"member",key:"member",render:e=>{var t,n;return(0,r.jsx)(q.A.Item.Meta,{title:null!==(n=null===(t=d[e])||void 0===t?void 0:t.name)&&void 0!==n?n:"",description:c(e)})}},{title:"Tổng tiền m\xf3n",dataIndex:"totalFood",align:"right",render:e=>new Intl.NumberFormat("en-US").format(e)},{title:"Ph\xed Ship",dataIndex:"shippingFee",align:"right",render:e=>new Intl.NumberFormat("en-US").format(e)},{title:"Giảm gi\xe1",dataIndex:"discountAmount",align:"right",render:e=>"-"+new Intl.NumberFormat("en-US").format(e)},{title:"Tổng phải trả",dataIndex:"money",key:"money",align:"right",render:e=>new Intl.NumberFormat("en-US").format(e)}],p=i.useMemo(()=>{let e=n.filter(e=>e.quantity>0&&e.member&&e.food),r=I().groupBy(e,"member"),i=I().keyBy(t,"id"),l=Object.keys(r).length,c=I().sumBy(e,"quantity"),u=I().round(s/l),m=I().round(s/c),p=I().round(o/l),g=I().round(o/c),x=I().round((s-o)/l),y=I().round((s-o)/c);return a===h.ShareByMember?Object.entries(r).map(e=>{let[t,n]=e,r=I().sumBy(n,e=>{var t;let n=i[e.food];return(null!==(t=null==n?void 0:n.price)&&void 0!==t?t:0)*e.quantity});return{key:t,member:t,totalFood:r,shippingFee:u,discountAmount:p,money:I().round(r+x)}}):Object.entries(r).map(e=>{var t,n;let[r,l]=e,a=I().sumBy(l,e=>{var t;let n=i[e.food];return(null!==(t=null==n?void 0:n.price)&&void 0!==t?t:0)*e.quantity}),o=I().sumBy(l.filter(e=>e.member===r),"quantity");return{key:r,member:null!==(n=null===(t=d[r])||void 0===t?void 0:t.name)&&void 0!==n?n:"",totalFood:a,shippingFee:m*o,discountAmount:g,money:I().round(a+y)}})},[n,a,o,t,d,s]);return(0,r.jsx)(j.A,{columns:u,dataSource:p,pagination:!1})};var T=n(13697),L=n(35906),_=n(25848),G=n(29214);let P="SHARE_BILL";var O=n(21455),D=n.n(O),Y=n(29288),H=n(41657),R=n(97295);let{Title:z,Paragraph:E}=Y.A,U=function(e){let{foodList:t,setFoodList:n,memberList:l,setMemberList:a}=e,o=Math.max(t.length,l.length),s=(0,S.G)(),[d,u]=i.useState(!1),h=i.useCallback((e,t)=>{let n=l.map((n,r)=>t===r?{...n,name:e}:n);t===l.length-1&&n.push({id:(0,T.A)(),name:""}),a(n)},[l,a]),m=i.useCallback((e,r)=>{let i=t.map((t,n)=>r===n?{...t,name:e}:t);r===t.length-1&&i.push({id:(0,T.A)(),name:"",price:null}),n(i)},[t,n]),y=i.useCallback((e,r)=>{let i=t.map((t,n)=>r===n?{...t,price:null!=e?e:0}:t);r===t.length-1&&i.push({id:(0,T.A)(),name:"",price:null!=e?e:null}),n(i)},[t,n]),v=i.useMemo(()=>{let e=[];for(let f=0;f<o;f++){var n,i,a,d,u,v,j,b,A;e.push((0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(g.A,{gutter:[10,10],style:{marginBottom:8},children:[(0,r.jsx)(x.A,{span:24,md:10,children:l[f]&&(0,r.jsx)(H.A,{value:null!==(u=null===(n=l[f])||void 0===n?void 0:n.name)&&void 0!==u?u:null,placeholder:s?"Tab để sang \xf4 kế tiếp":"T\xean th\xe0nh vi\xean",onChange:e=>h(e.target.value,f)})}),t[f]?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(x.A,{span:24,md:10,children:(0,r.jsx)(H.A,{value:null!==(v=null===(i=t[f])||void 0===i?void 0:i.name)&&void 0!==v?v:null,placeholder:s?"Tab để sang \xf4 kế tiếp":"T\xean m\xf3n",onChange:e=>m(e.target.value,f)})}),(0,r.jsx)(x.A,{span:24,md:4,children:(0,r.jsx)(p.A,{style:{width:"100%"},value:null!==(j=null===(a=t[f])||void 0===a?void 0:a.price)&&void 0!==j?j:null,formatter:e=>"".concat(e).replace(/\B(?=(\d{3})+(?!\d))/g,","),placeholder:s?"Tab để sang \xf4 kế tiếp":"Gi\xe1 tiền",onChange:e=>y(e,f),suffix:"đ",step:1e3})})]}):null]},null!==(A=null!==(b=null===(d=l[f])||void 0===d?void 0:d.id)&&void 0!==b?b:t[f].id)&&void 0!==A?A:f),f<o-1&&!s&&(0,r.jsx)(c.A,{})]}))}return e},[t,s,o,l,m,h,y]);return(0,r.jsxs)(r.Fragment,{children:[s&&(0,r.jsxs)(g.A,{gutter:[10,10],children:[(0,r.jsx)(x.A,{span:24,md:10,children:(0,r.jsx)(z,{level:5,children:"T\xean th\xe0nh vi\xean"})}),(0,r.jsx)(x.A,{span:24,md:10,children:(0,r.jsx)(z,{level:5,children:"T\xean m\xf3n"})}),(0,r.jsx)(x.A,{span:24,md:4,children:(0,r.jsx)(z,{level:5,children:"Gi\xe1 tiền"})})]}),v,(0,r.jsx)(g.A,{children:(0,r.jsx)(x.A,{span:24,children:(0,r.jsx)("a",{onClick:()=>u(!0),children:"C\xf3 nhiều người đặt m\xf3n giống nhau?"})})}),(0,r.jsxs)(R.A,{footer:null,open:d,onCancel:()=>u(!1),children:[(0,r.jsx)(z,{level:4,children:"C\xf3 nhiều hơn một người c\xf9ng đặt m\xf3n giống nhau?"}),(0,r.jsx)(E,{children:"Đừng lo. Bạn chỉ cần nhập t\xean những người ấy v\xe0o \xf4 t\xean th\xe0nh vi\xean ở cuối danh s\xe1ch v\xe0 bỏ trống c\xe1c cột t\xean m\xf3n v\xe0 gi\xe1. Giao diện ở bước tiếp theo sẽ cho bạn lựa chọn những người n\xe0o đặt m\xf3n ấy."}),(0,r.jsx)(z,{level:4,children:"C\xf3 một người đặt nhiều m\xf3n?"}),(0,r.jsx)(E,{children:"Cũng tương tự như tr\xean. Bạn chỉ việc nhập t\xean v\xe0 gi\xe1 của m\xf3n đ\xf3 ở cột t\xean v\xe0 m\xf3n v\xe0o cuối danh s\xe1ch. Giao diện ở bước tiếp theo sẽ gi\xfap bạn lựa chọn người n\xe0o đặt những m\xf3n n\xe0o."})]})]})},K=function(e){let{setStartTransaction:t}=e,{token:n}=s.A.useToken(),[m,p]=i.useState(0),[g,x]=i.useState([{id:(0,T.A)(),name:"",price:null}]),[y,v]=i.useState([{id:(0,T.A)(),name:""}]),[j,b]=i.useState([]),[A,f]=i.useState(0),[k,C]=i.useState(0),[B,q]=i.useState(h.ShareByMember),{mutate:F}=function(){let e=(0,L.jE)();return(0,_.n)({mutationFn:G.wN,onSuccess(){e.invalidateQueries({queryKey:[P]})}})}(),I=(0,S.G)(),M=[{title:"Nhập dữ liệu",content:(0,r.jsx)(U,{foodList:g,setFoodList:x,memberList:y,setMemberList:v})},{title:"Chia tiền",content:(0,r.jsx)(w,{foodList:g,memberList:y,billItems:j,setBillItems:b,shippingFee:A,setShippingFee:f,discountAmount:k,setDiscountAmount:C,calculatorMode:B,setCalculatorMode:q})},{title:"Kết quả",content:(0,r.jsx)(N,{foodList:g,billItems:j,calculatorMode:B,shippingFee:A,discountAmount:k,memberList:y})}],O=()=>{let e=[];for(let[t,n]of g.filter(e=>e.name).entries())for(let[r,i]of y.filter(e=>e.name).entries())e.push({id:(0,T.A)(),food:n.id,member:i.id,quantity:t===r?1:0});b(e)},Y=()=>{m===M.length-3&&O(),p(m+1)},H=()=>{p(m-1)},R=()=>{F({foodList:g,memberList:y,billItems:j,shippingFee:A,discountAmount:k,calculatorMode:B,created_at:new Date,id:(0,T.A)(),name:"Chia tiền ng\xe0y ".concat(D()().format("DD/MM/YYYY HH:mm:ss"))}),x([{id:(0,T.A)(),name:"",price:null}]),v([{id:(0,T.A)(),name:""}]),b([]),f(0),p(0),C(0),q(h.ShareByMember),t(!1)},z=M.map(e=>({key:e.title,title:e.title})),E={color:n.colorTextTertiary,borderRadius:n.borderRadiusLG};return(0,r.jsx)(l.A,{justify:"center",align:"center",style:{height:"100vh",background:"url('/ban-tiec.jpeg')",backgroundSize:"cover",backgroundRepeat:"no-repeat",backgroundPosition:"center",padding:20,overflow:"auto"},children:(0,r.jsxs)(a.A,{style:{width:"100%",background:"rgba(255, 255, 255, 0.8)",backdropFilter:"blur(10px)"},styles:{body:{overflow:"auto",height:"calc(100vh - 100px)"}},children:[(0,r.jsx)(d.A,{current:m,items:z}),!I&&(0,r.jsx)(c.A,{}),(0,r.jsx)("div",{style:E,className:"transaction-wrapper",children:M[m].content}),(0,r.jsx)(c.A,{}),(0,r.jsxs)("div",{children:[m<M.length-1&&(0,r.jsx)(o.Ay,{type:"primary",onClick:()=>Y(),children:"Tiếp"}),m===M.length-1&&(0,r.jsx)(o.Ay,{type:"primary",onClick:()=>{u.Ay.success("Processing complete!"),R()},children:"Xong"}),m>0&&(0,r.jsx)(o.Ay,{style:{margin:"0 8px"},onClick:()=>H(),children:"Trước"})]})]})})};var J=n(547);let{Title:Q}=Y.A,X=function(){let{data:e}=(0,J.I)({queryKey:[P],queryFn:()=>(0,G.HM)()}),[t,n]=i.useState(null),[l,a]=i.useState(!1),o=[{title:"T\xean",dataIndex:"name",key:"name",render:(e,t)=>(0,r.jsx)("a",{onClick:()=>{n(t),a(!0)},children:e})}];return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(Q,{level:3,children:"Lịch sử"}),(0,r.jsx)(j.A,{columns:o,dataSource:e,pagination:!1,className:"share-bill-table"}),(0,r.jsx)(R.A,{footer:!1,open:l,onCancel:()=>a(!1),width:{xs:"90%",sm:"90%",md:"90%",lg:"80%",xl:"70%",xxl:"60%"},children:t&&(0,r.jsx)(N,{billItems:t.billItems,calculatorMode:t.calculatorMode,shippingFee:t.shippingFee,discountAmount:t.discountAmount,foodList:t.foodList,memberList:t.memberList})})]})},$=()=>{let[e,t]=i.useState(!1);return e?(0,r.jsx)(K,{setStartTransaction:t}):(0,r.jsx)(l.A,{justify:"center",align:"center",className:"app-container",style:{background:"url('/chia-tien.jpeg')"},children:(0,r.jsxs)(a.A,{title:"Chia tiền ho\xe1 đơn",className:"app-card share-bill-card",children:[(0,r.jsx)(l.A,{justify:"center",align:"center",children:(0,r.jsx)(o.Ay,{size:"large",type:"primary",onClick:()=>{t(!0)},children:"Bắt đầu"})}),(0,r.jsx)(X,{})]})})},V=$},29214:(e,t,n)=>{"use strict";n.d(t,{Bu:()=>d,HM:()=>h,l_:()=>u,wN:()=>m});var r=n(21455),i=n.n(r),l=n(56818),a=n(14449),o=n(49113),s=n.n(o);let d=a.Oh.addCollection(l.q.ShareBill);class c extends a.Ay{getShareBill(){return super.getAll(this.store)}async syncShareBill(){let e=d.find({});for(let t of(await super.deleteAll(this.store),e)){let e=s().omit(t,["$loki","meta"]);await super.save(this.store,e)}return e}constructor(...e){super(...e),this.store=l.q.ShareBill}}let u=new c;function h(){return d.find({}).sort((e,t)=>new Date(t.created_at).getTime()>new Date(e.created_at).getTime()?1:-1)}async function m(e){let t=await Promise.resolve(d.insert({...e,name:"Chia tiền ng\xe0y ".concat(i()().format("DD/MM/YYYY HH:mm:ss")),created_at:i()().toDate()}));return await u.syncShareBill(),t}},56818:(e,t,n)=>{"use strict";n.d(t,{q:()=>r});var r=function(e){return e.RandomList="random_list",e.ShareBill="share_bill",e}({})},14449:(e,t,n)=>{"use strict";n.d(t,{Ay:()=>s,Oh:()=>a});var r=n(51288),i=n.n(r),l=n(56818);let a=new(i())("anuong.db");class o{async init(){return this.database?this.database:new Promise((e,t)=>{let n=window.indexedDB.open("anuong",1);n.onupgradeneeded=()=>{let e=n.result;e.objectStoreNames.contains(l.q.RandomList)||e.createObjectStore(l.q.RandomList,{keyPath:"id",autoIncrement:!0}),e.objectStoreNames.contains(l.q.ShareBill)||e.createObjectStore(l.q.ShareBill,{keyPath:"id",autoIncrement:!0})},n.onsuccess=()=>{this.database=n.result,e(this.database)},n.onerror=()=>{t(n.error)}})}async save(e,t){let n=await this.init();return new Promise((r,i)=>{let l=n.transaction(e,"readwrite").objectStore(e),a=JSON.parse(JSON.stringify(t)),o=l.add(a);o.onsuccess=()=>r(),o.onerror=()=>i(o.error)})}async getAll(e){let t=await this.init();return new Promise((n,r)=>{let i=t.transaction(e,"readonly").objectStore(e).getAll();i.onsuccess=()=>n(i.result),i.onerror=()=>r(i.error)})}async deleteAll(e){let t=await this.init();return new Promise((n,r)=>{let i=t.transaction(e,"readwrite").objectStore(e).clear();i.onsuccess=()=>n(e),i.onerror=()=>r(i.error)})}constructor(){this.database=null}}let s=o},65872:(e,t,n)=>{"use strict";n.d(t,{G:()=>l});var r=n(12115),i=n(12942);let l=()=>{var e;let[t,n]=r.useState(null),l=(0,i.A)(t),a=(null!==(e=null==l?void 0:l.width)&&void 0!==e?e:0)>=768;return(0,r.useEffect)(()=>{var e,t;n(null===(t=window)||void 0===t?void 0:null===(e=t.document)||void 0===e?void 0:e.body)},[]),a}},6536:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[65,935,600,103,838,256,529,474,441,517,358],()=>t(79516)),_N_E=e.O()}]);